<!DOCTYPE html>
<html>
<head>
<title>个人信息</title>
<meta charset="utf-8">
</head>
<body>
	<section class="wrapper">
              <div class="mail-box">
                      <div class="inbox-head">
                          <h3>个人信息</h3>
                          <div class="pull-right position" >
                              <div class="input-append">
                              </div>
                          </div>
                      </div>
	           <form id="sys_form" method="post"  action=""  class="form-horizontal">
					<div class="modal-body">
						<input type="text"  name="role" value="2" hidden="hidden">
						<div class="form-group clearfix">
							<label class="col-sm-3 control-label" for="login">登录名</label>
							<div class="col-sm-9">
								<input type="text" class="form-control input-sm" id="login" name="login" readonly>
							</div>
						</div>
						<div class="form-group clearfix">
							<label class="col-sm-3 control-label" for="name">用户姓名</label>
							<div class="col-sm-9">
								<input type="text" class="form-control input-sm" id="name" name="name" readonly>
							</div>
						</div>
						<div class="form-group clearfix">
							<label class="col-sm-3 control-label" for="tel">联系电话</label>
							<div class="col-sm-9">
								<input type="text" class="form-control input-sm" id="tel" name="tel">
							</div>
						</div>
						<div class="form-group clearfix">
							<label class="col-sm-3 control-label" for="qq">QQ</label>
							<div class="col-sm-9">
								<input type="text" class="form-control input-sm" id="qq" name="qq">
							</div>
						</div>
						<div class="form-group clearfix">
							<label class="col-sm-3 control-label" for="desc">备注</label>
							<div class="col-sm-9">
								<textarea class="form-control" id="desc" name="desc"></textarea>
							</div>
						</div>
						<div class="form-group" style="margin-top: 15px;">
							<div class="col-lg-2">
							</div>
							<div class="col-lg-6" style="text-align: right;">
								<button class="btn btn-sm btn-primary" type="submit" ><i class="fa fa-save "></i>保存</button>
							</div>
						</div>
					</div>
				</form>
              </div>
          </section>
<script type="text/javascript">
	 $(function() {
		 initData();
		 initValidate();
	});
	//获取用户资料
	function initData(){
		$.get("/setting", function(data) {
			if (data.code == 1) {
				for(var key in data.result){
					$("#"+key).val(data.result[key]);
				}
				$("#sys_form").attr("action","api/users/"+data.result._id);
			} else {
				yeshidenotify('error', 'top right', "获取个人信息失败", "提示将在3秒内关闭",3000);
			}
		});
	}
	
	//form表单校验
	function initValidate() {
		$('#sys_form').on('init.field.bv', function(e, data) {
            var $parent = data.element.parents('.form-group'),
                $icon   = $parent.find('.form-control-feedback[data-bv-icon-for="' + data.field + '"]');

            $icon.on('click.clearing', function () {
                if ($icon.hasClass('glyphicon-remove')) {
                    data.bv.resetField(data.element);
                }
            });
        })
        .bootstrapValidator({
            excluded: ':disabled',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
			fields: {
				'name': {
					validators: {
						notEmpty: {
							message: '用户姓名不能为空！'
						}
					}
				},
				'login': {
					validators: {
						notEmpty: {
							message: '登录名不能为空！'
						}
					}
				}
			}
        }) .on('success.form.bv', function (e) {
            e.preventDefault();

            var $form = $(e.target);
            $.post($form.attr('action'),$form.serialize(),
            	function (msg) {
	                if (msg.code == 1) {
	                	yeshidenotify('success', 'top right', "个人信息修改成功", "提示将在3秒内关闭",3000);
	                } else {
	                	yeshidenotify('error', 'top right', "个人信息修改失败", "提示将在3秒内关闭",3000);
	                }
            	}, 'json');
        });
	}
</script>
</body>
</html>
